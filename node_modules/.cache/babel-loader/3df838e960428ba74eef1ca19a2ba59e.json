{"ast":null,"code":"import _defineProperty from\"/home/kevilinrodrigues/Documentos/myreps/portfolio-dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/kevilinrodrigues/Documentos/myreps/portfolio-dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/kevilinrodrigues/Documentos/myreps/portfolio-dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/kevilinrodrigues/Documentos/myreps/portfolio-dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/kevilinrodrigues/Documentos/myreps/portfolio-dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/kevilinrodrigues/Documentos/myreps/portfolio-dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState}from\"react\";import{collection,addDoc}from\"firebase/firestore\";import{nanoid}from\"nanoid\";import app from\"../../../firebase/firebaseConfig\";import{getFirestore}from\"firebase/firestore\";import{getDownloadURL,getStorage,ref,uploadBytes}from\"firebase/storage\";var storage=getStorage(app);var db=getFirestore(app);export var HandleClick=function HandleClick(){//eslint-disable-next-line\nvar _useState=useState(nanoid()),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),toSubmit=_useState4[0],setToSubmit=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),redirect=_useState6[0],setRedirect=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),inputs=_useState8[0],setInputs=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),url_imagem=_useState10[0],seturl_imagem=_useState10[1];//Upload post firebase\nvar firebaseAdd=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return addDoc(collection(db,\"posts\"),{inputs:inputs});case 3:_context.next=8;break;case 5:_context.prev=5;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 8:case\"end\":return _context.stop();}}},_callee,null,[[0,5]]);}));return function firebaseAdd(){return _ref.apply(this,arguments);};}();//When the form is submit\nvar handleSubmit=function handleSubmit(e){handleStorage();var validate=inputs.projeto===\"\"||inputs.url_site===\"\"||inputs.tecnologias===\"\"||inputs.url_github===\"\";e.preventDefault();if(validate){return alert(\"Revise todos os campos\");}setToSubmit(true);setTimeout(function(){setToSubmit(false);setRedirect(true);},3000);firebaseAdd();};//Upload images to Firebase\nvar onFileChange=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var file,fileRef,upload,url_imagemAwait;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(url_imagem.length<3)){_context2.next=12;break;}//Read file\nfile=e.target.files[0];//Upload\nfileRef=ref(storage,\"documents/\".concat(file.name));_context2.next=5;return uploadBytes(fileRef,file);case 5:upload=_context2.sent;_context2.next=8;return getDownloadURL(fileRef);case 8:url_imagemAwait=_context2.sent;seturl_imagem(function(prevurl_imagem){return[].concat(_toConsumableArray(prevurl_imagem),[{url_imagem:url_imagemAwait,imageData:upload.ref.name}]);});_context2.next=13;break;case 12:return _context2.abrupt(\"return\",alert(\"Só é possivel inserir 3 imagens.\"));case 13:case\"end\":return _context2.stop();}}},_callee2);}));return function onFileChange(_x){return _ref2.apply(this,arguments);};}();//Create key for user\nvar handleStorage=function handleStorage(){window.localStorage.setItem(\"text\",user);};//Read and save inputs value on state\nvar handleChange=function handleChange(e){var _objectSpread2;setInputs(_objectSpread(_objectSpread({},inputs),{},(_objectSpread2={},_defineProperty(_objectSpread2,e.target.name,e.target.value),_defineProperty(_objectSpread2,\"url_imagem\",url_imagem),_defineProperty(_objectSpread2,\"user\",user),_objectSpread2)));};return{handleSubmit:handleSubmit,handleChange:handleChange,onFileChange:onFileChange,firebaseAdd:firebaseAdd,url_imagem:url_imagem,toSubmit:toSubmit,redirect:redirect};};","map":{"version":3,"sources":["/home/kevilinrodrigues/Documentos/myreps/portfolio-dev/src/pages/Submit/Form/Form.logical.js"],"names":["useState","collection","addDoc","nanoid","app","getFirestore","getDownloadURL","getStorage","ref","uploadBytes","storage","db","HandleClick","user","setUser","toSubmit","setToSubmit","redirect","setRedirect","inputs","setInputs","url_imagem","seturl_imagem","firebaseAdd","console","error","handleSubmit","e","handleStorage","validate","projeto","url_site","tecnologias","url_github","preventDefault","alert","setTimeout","onFileChange","length","file","target","files","fileRef","name","upload","url_imagemAwait","prevurl_imagem","imageData","window","localStorage","setItem","handleChange","value"],"mappings":"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","sourcesContent":["import { useState } from \"react\";\nimport { collection, addDoc } from \"firebase/firestore\";\nimport { nanoid } from \"nanoid\";\nimport app from \"../../../firebase/firebaseConfig\";\nimport { getFirestore } from \"firebase/firestore\";\nimport { getDownloadURL, getStorage, ref, uploadBytes } from \"firebase/storage\";\nconst storage = getStorage(app);\nconst db = getFirestore(app);\n\nexport const HandleClick = () => {\n  //eslint-disable-next-line\n  const [user, setUser] = useState(nanoid());\n  const [toSubmit, setToSubmit] = useState(false);\n  const [redirect, setRedirect] = useState(false);\n  const [inputs, setInputs] = useState({});\n  const [url_imagem, seturl_imagem] = useState([]);\n\n  //Upload post firebase\n  const firebaseAdd = async () => {\n    try {\n      await addDoc(collection(db, \"posts\"), {\n        inputs,\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  //When the form is submit\n  const handleSubmit = (e) => {\n    handleStorage();\n    const validate = inputs.projeto === \"\" || inputs.url_site === \"\" || inputs.tecnologias === \"\" || inputs.url_github === \"\";\n    e.preventDefault();\n    if (validate) {\n      return alert(\"Revise todos os campos\");\n    }\n    setToSubmit(true);\n    setTimeout(() => {\n      setToSubmit(false);\n      setRedirect(true);\n    }, 3000);\n    firebaseAdd();\n  };\n\n  //Upload images to Firebase\n  const onFileChange = async (e) => {\n    if (url_imagem.length < 3) {\n      //Read file\n      const file = e.target.files[0];\n      //Upload\n      const fileRef = ref(storage, `documents/${file.name}`);\n      const upload = await uploadBytes(fileRef, file);\n      //Get the url for download\n      const url_imagemAwait = await getDownloadURL(fileRef);\n      seturl_imagem((prevurl_imagem) => [...prevurl_imagem, { url_imagem: url_imagemAwait, imageData: upload.ref.name }]);\n    } else {\n      return alert(\"Só é possivel inserir 3 imagens.\");\n    }\n  };\n\n  //Create key for user\n  const handleStorage = () => {\n    window.localStorage.setItem(\"text\", user);\n  };\n\n  //Read and save inputs value on state\n  const handleChange = (e) => {\n    setInputs({\n      ...inputs,\n      [e.target.name]: e.target.value,\n      url_imagem,\n      user,\n    });\n  };\n\n  return { handleSubmit, handleChange, onFileChange, firebaseAdd, url_imagem, toSubmit, redirect };\n};\n"]},"metadata":{},"sourceType":"module"}